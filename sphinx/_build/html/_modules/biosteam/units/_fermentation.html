

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>biosteam.units._fermentation &mdash; BioSTEAM 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../../',
              VERSION:'0.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> BioSTEAM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Getting started.html">1. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../MixedStream objects and thermodynamic equilibrium.html">2. MixedStream objects and thermodynamic equilibrium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Creating a Unit.html">3. Creating a Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit operation examples.html">4. Unit operation examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Find unit operations and manage flowsheets.html">5. Find unit operations and manage flowsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Using -pipe- notation.html">6. Using -pipe- notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Techno-economic analysis of a biorefinery.html">7. Techno-economic analysis of a biorefinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Inheriting from Unit.html">8. Inheriting from Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit decorators.html">9. Unit decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Advanced simulation.html">10. Advanced simulation</a></li>
</ul>
<p class="caption"><span class="caption-text">BioSTEAM API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Species.html">Species</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Stream.html">Stream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../MixedStream.html">MixedStream</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit.html">Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PowerUtility.html">PowerUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../HeatUtility.html">HeatUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../System.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TEA.html">TEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Flowsheet.html">find</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../compounds.html">compounds</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../inspect.html">inspect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluation.html">evaluation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BioSTEAM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>biosteam.units._fermentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for biosteam.units._fermentation</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Aug 23 22:45:47 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">._reactor</span> <span class="k">import</span> <span class="n">BatchReactor</span>
<span class="kn">from</span> <span class="nn">._hx</span> <span class="k">import</span> <span class="n">HXutility</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="k">import</span> <span class="n">Stream</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">odeint</span>
<span class="kn">from</span> <span class="nn">.decorators</span> <span class="k">import</span> <span class="n">cost</span>
<span class="kn">from</span> <span class="nn">._tank</span> <span class="k">import</span> <span class="n">MixTank</span>

<div class="viewcode-block" id="Fermentation"><a class="viewcode-back" href="../../../Fermentation.html#biosteam.units.Fermentation">[docs]</a><span class="nd">@cost</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Agitator&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">,</span> <span class="n">CE</span><span class="o">=</span><span class="mf">521.9</span><span class="p">,</span>
      <span class="n">cost</span><span class="o">=</span><span class="mi">52500</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">3785</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">kW</span><span class="o">=</span><span class="mf">22.371</span><span class="p">)</span>
<span class="nd">@cost</span><span class="p">(</span><span class="s1">&#39;Volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Reactors&#39;</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">,</span> <span class="n">CE</span><span class="o">=</span><span class="mf">521.9</span><span class="p">,</span>
      <span class="n">cost</span><span class="o">=</span><span class="mi">844000</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">3785</span><span class="p">,</span> <span class="n">exp</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Fermentation</span><span class="p">(</span><span class="n">BatchReactor</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create a Fermentation object which models large-scale batch fermentation for the production of 1st generation ethanol using yeast [1, 2, 3, 4]. Only sucrose and glucose are taken into account. Conversion is based on reaction time, `tau`. Cleaning and unloading time, `tau_0`, fraction of working volume, `V_wf`, and number of reactors, `N_reactors`, are attributes that can be changed. Cost of a reactor is based on the NREL batch fermentation tank cost assuming volumetric scaling with a 6/10th exponent [3].</span>
<span class="sd">    </span>
<span class="sd">    **Parameters**</span>
<span class="sd">    </span>
<span class="sd">        **tau:** Reaction time.</span>
<span class="sd">        </span>
<span class="sd">        **efficiency:** User enforced efficiency.</span>
<span class="sd">        </span>
<span class="sd">        **N:** Number of batch reactors</span>
<span class="sd">    </span>
<span class="sd">    **ins**</span>
<span class="sd">    </span>
<span class="sd">        [:] Inffluent streams</span>
<span class="sd">        </span>
<span class="sd">    **outs**</span>
<span class="sd">    </span>
<span class="sd">        [0] Effluent</span>
<span class="sd">        </span>
<span class="sd">        [1] CO2</span>
<span class="sd">    </span>
<span class="sd">    **References**</span>
<span class="sd">    </span>
<span class="sd">        [1] Oliveira, Samuel C., et al. &quot;Discrimination between ethanol inhibition models in a continuous alcoholic fermentation process using flocculating yeast.&quot; Applied biochemistry and biotechnology 74.3 (1998): 161-172.</span>
<span class="sd">        </span>
<span class="sd">        [2] Oliveira, Samuel C., et al. &quot;Continuous ethanol fermentation in a tower reactor with flocculating yeast recycle: scale-up effects on process performance, kinetic parameters and model predictions.&quot; Bioprocess Engineering 20.6 (1999): 525-530.</span>
<span class="sd">        </span>
<span class="sd">        [3] Oliveira, Samuel C., et al. &quot;Mathematical modeling of a continuous alcoholic fermentation process in a two-stage tower reactor cascade with flocculating yeast recycle.&quot; Bioprocess and biosystems engineering 38.3 (2015): 469-479.</span>
<span class="sd">        </span>
<span class="sd">        [4] Oliveira, Samuel C., et al. &quot;Kinetic Modeling of 1‚ÄêG Ethanol Fermentations.&quot; Fermentation Processes. InTech, 2017.</span>
<span class="sd">        </span>
<span class="sd">        [5] D. Humbird, R. Davis, L. Tao, C. Kinchin, D. Hsu, and A. Aden National. Renewable Energy Laboratory Golden, Colorado. P. Schoen, J. Lukas, B. Olthof, M. Worley, D. Sexton, and D. Dudgeon. Harris Group Inc. Seattle, Washington and Atlanta, Georgia. Process Design and Economics for Biochemical Conversion of Lignocellulosic Biomass to Ethanol Dilute-Acid Pretreatment and Enzymatic Hydrolysis of Corn Stover. May 2011. Technical Report NREL/TP-5100-47764</span>
<span class="sd">        </span>
<span class="sd">    .. note::</span>
<span class="sd">        </span>
<span class="sd">        A compound with CAS &#39;Yeast&#39; must be present in species.</span>
<span class="sd">        </span>
<span class="sd">    **Examples**</span>
<span class="sd">    </span>
<span class="sd">        :doc:`Fermentation Example`</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Volume&#39;</span><span class="p">:</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Cycle time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Loading time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Total dead time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">}</span>
    <span class="n">_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1"># Reaction time</span>
               <span class="s1">&#39;efficiency&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
               <span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>  <span class="c1"># Theoretical efficiency</span>
    <span class="n">_N_heat_utilities</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_has_power_utility</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;Fermentation&#39;</span>    
    
    <span class="c1">#: Cleaning and unloading time (hr)</span>
    <span class="n">tau_0</span> <span class="o">=</span> <span class="mi">12</span> 
    
    <span class="c1">#: Number of reactors</span>
    <span class="n">_N_reactors</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="c1">#: Fraction of filled tank to total tank volume</span>
    <span class="n">working_volume_fraction</span> <span class="o">=</span> <span class="n">MixTank</span><span class="o">.</span><span class="n">working_volume_fraction</span>
    <span class="n">_V_wf</span> <span class="o">=</span> <span class="mf">0.8</span>
    
    <span class="c1">#: tuple of kinetic parameters for the kinetic model. Default constants are fitted for Oliveria&#39;s model (mu_m1, mu_m2, Ks1, Ks2, Pm1, Pm2, Xm, Y_PS, a)</span>
    <span class="n">kinetic_constants</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.31</span><span class="p">,</span>  <span class="c1"># mu_m1</span>
                         <span class="mf">1.01</span><span class="p">,</span>  <span class="c1"># mu_m2</span>
                         <span class="mf">1.88</span><span class="p">,</span>  <span class="c1"># Ks1</span>
                         <span class="mf">2.81</span><span class="p">,</span>  <span class="c1"># Ks2</span>
                         <span class="mf">82.8</span><span class="p">,</span>  <span class="c1"># Pm1</span>
                         <span class="mf">108.2</span><span class="p">,</span> <span class="c1"># Pm2</span>
                         <span class="mf">113.4</span><span class="p">,</span> <span class="c1"># Xm</span>
                         <span class="mf">0.45</span><span class="p">,</span>  <span class="c1"># Y_PS</span>
                         <span class="mf">0.18</span><span class="p">)</span>  <span class="c1"># a</span>

    <span class="k">def</span> <span class="nf">_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cooler</span> <span class="o">=</span> <span class="n">hx</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_heat_utilities</span> <span class="o">=</span> <span class="n">hx</span><span class="o">.</span><span class="n">_heat_utilities</span>
        <span class="c1"># Species involved in fermentation</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_species_index</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">Stream</span><span class="p">,</span>
                <span class="s1">&#39;64-17-5&#39;</span><span class="p">,</span> <span class="s1">&#39;492-61-5&#39;</span><span class="p">,</span> <span class="s1">&#39;57-50-1&#39;</span><span class="p">,</span> <span class="s1">&#39;7732-18-5&#39;</span><span class="p">,</span> <span class="s1">&#39;124-38-9&#39;</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_species_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">_ins</span> <span class="o">=</span> <span class="n">hx</span><span class="o">.</span><span class="n">_outs</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">_outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="mf">273.15</span>
    
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;reaction time must be larger than 0, not &#39;</span><span class="si">{self._kwargs[&#39;tau&#39;]}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;number of reactors must be greater than 1, value </span><span class="si">{self._kwargs[&#39;N&#39;]}</span><span class="s2"> is infeasible&quot;</span><span class="p">)</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">CO2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">out</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">CO2</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="mf">273.15</span>
        <span class="n">CO2</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>

    <span class="k">def</span> <span class="nf">_calc_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="c1"># Get initial concentrations</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="s1">&#39;Yeast&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;64-17-5&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;492-61-5&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;7732-18-5&#39;</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">mass</span>
        <span class="n">volnet</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">volnet</span>
        <span class="n">concentration_in</span> <span class="o">=</span> <span class="n">mass</span><span class="o">/</span><span class="n">volnet</span>
        <span class="n">X0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">S0</span> <span class="o">=</span> <span class="p">(</span><span class="n">concentration_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
        
        <span class="c1"># Integrate to get final concentration</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">C_t</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kinetic_model</span><span class="p">,</span> <span class="p">(</span><span class="n">X0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">S0</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span>
                     <span class="n">args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kinetic_constants</span><span class="p">)</span>
        <span class="c1"># Cache data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_X</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Calculate efficiency</span>
        <span class="n">Sf</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Sf</span> <span class="o">=</span> <span class="n">Sf</span> <span class="k">if</span> <span class="n">Sf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">Y_PS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinetic_constants</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eff</span> <span class="o">=</span> <span class="p">(</span><span class="n">S0</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">)</span><span class="o">/</span><span class="n">S0</span> <span class="o">*</span> <span class="n">Y_PS</span><span class="o">/</span><span class="mf">0.511</span>
        <span class="k">return</span> <span class="n">eff</span>
        
<div class="viewcode-block" id="Fermentation.kinetic_model"><a class="viewcode-back" href="../../../Fermentation.html#biosteam.units.Fermentation.kinetic_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">kinetic_model</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">kinetic_constants</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;(dXdt, dPdt, dSdt)&#39;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return change of yeast, ethanol, and substrate concentration in kg/m3.</span>
<span class="sd">        </span>
<span class="sd">        **Parameters**</span>
<span class="sd">        </span>
<span class="sd">            **z:** Iterable with (X, E, S) [-]:</span>
<span class="sd">                * X: Yeast concentration (kg/m3)</span>
<span class="sd">                * P: Ethanol concentration (kg/m3)</span>
<span class="sd">                * S: Substrate concentration (kg/m3)</span>
<span class="sd">            </span>
<span class="sd">            **t:** Time point</span>
<span class="sd">            </span>
<span class="sd">            ***kinetic_constants:**</span>
<span class="sd">                * mu_m1: Maximum specific growth rate (1/hr)</span>
<span class="sd">                * mu_m2: Maximum specific ethanol production rate (g-product/g-cell-hr)</span>
<span class="sd">                * Ks1: Sugar saturation constant for growth (g/L)</span>
<span class="sd">                * Ks2: Sugar saturation constant for product (g/L)</span>
<span class="sd">                * Pm1: Maximum product concentration at zero growth [mu_m1=0] (g/L)</span>
<span class="sd">                * Pm2: Maximum product concentration [mu_m2=0] (g/L)</span>
<span class="sd">                * Xm: Maximum cell concentration [mu_m1=0] (g/L)</span>
<span class="sd">                * Y_PS: Ethanol yield based on sugar consumed</span>
<span class="sd">                * a: Toxic power</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_m1</span><span class="p">,</span> <span class="n">mu_m2</span><span class="p">,</span> <span class="n">Ks1</span><span class="p">,</span> <span class="n">Ks2</span><span class="p">,</span> <span class="n">Pm1</span><span class="p">,</span> <span class="n">Pm2</span><span class="p">,</span> <span class="n">Xm</span><span class="p">,</span> <span class="n">Y_PS</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">kinetic_constants</span>
        
        <span class="c1"># Current yeast, ethanol, and glucose concentration (kg/m3)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">z</span>
        
        <span class="c1"># Compute coefficients</span>
        <span class="n">mu_X</span> <span class="o">=</span> <span class="n">mu_m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">Ks1</span> <span class="o">+</span> <span class="n">S</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="o">/</span><span class="n">Pm1</span><span class="p">)</span><span class="o">**</span><span class="n">a</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">X</span><span class="o">/</span><span class="n">Xm</span><span class="p">))</span>
        <span class="n">mu_P</span> <span class="o">=</span> <span class="n">mu_m2</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">Ks2</span> <span class="o">+</span> <span class="n">S</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="o">/</span><span class="n">Pm2</span><span class="p">)</span>
        <span class="n">mu_S</span> <span class="o">=</span> <span class="n">mu_P</span><span class="o">/</span><span class="mf">0.45</span>
        
        <span class="c1"># Compute derivatives</span>
        <span class="n">dXdt</span> <span class="o">=</span> <span class="n">mu_X</span> <span class="o">*</span> <span class="n">X</span>
        <span class="n">dPdt</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_P</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span>
        <span class="n">dSdt</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">mu_S</span> <span class="o">*</span> <span class="n">X</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dXdt</span><span class="p">,</span> <span class="n">dPdt</span><span class="p">,</span> <span class="n">dSdt</span><span class="p">)</span></div>
       
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N_reactors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
    <span class="nd">@N_reactors</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">N_reactors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;number of reactors must be greater than 1, value </span><span class="si">{N}</span><span class="s2"> is infeasible&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Assume no Glycerol produced</span>
        <span class="c1"># No ethanol lost with CO2</span>
        <span class="n">mw_Ethanol</span> <span class="o">=</span> <span class="mf">46.06844</span>
        <span class="n">mw_glucose</span> <span class="o">=</span> <span class="mf">180.156</span>

        <span class="c1"># Unpack</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">CO2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_outs</span>
        <span class="n">out</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ins</span><span class="p">)</span>
        <span class="n">e</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">co2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species_index</span> <span class="ow">or</span> <span class="n">out</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">Stream</span><span class="p">,</span>
                <span class="s1">&#39;64-17-5&#39;</span><span class="p">,</span> <span class="s1">&#39;492-61-5&#39;</span><span class="p">,</span> <span class="s1">&#39;57-50-1&#39;</span><span class="p">,</span> <span class="s1">&#39;7732-18-5&#39;</span><span class="p">,</span> <span class="s1">&#39;124-38-9&#39;</span><span class="p">,</span> <span class="n">CAS</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">glucose</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
        <span class="n">sucrose</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        
        <span class="c1"># Hydrolysis</span>
        <span class="n">new_glucose</span> <span class="o">=</span> <span class="n">sucrose</span><span class="o">*</span><span class="mi">2</span>
        <span class="n">ch_sucrose</span> <span class="o">=</span> <span class="o">-</span><span class="n">sucrose</span>
        <span class="n">ch_Water</span> <span class="o">=</span> <span class="o">-</span><span class="n">sucrose</span>
        <span class="n">out</span><span class="o">.</span><span class="n">_mol</span><span class="p">[[</span><span class="n">g</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span><span class="p">]]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">new_glucose</span><span class="p">,</span> <span class="n">ch_sucrose</span><span class="p">,</span> <span class="n">ch_Water</span><span class="p">]</span>
        
        <span class="c1"># Fermentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Design&#39;</span><span class="p">][</span><span class="s1">&#39;Efficiency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eff</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;efficiency&#39;</span><span class="p">)</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_efficiency</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">])</span>
            <span class="p">)</span>
        <span class="n">fermented</span> <span class="o">=</span> <span class="n">eff</span><span class="o">*</span><span class="p">(</span><span class="n">glucose</span> <span class="o">+</span> <span class="n">new_glucose</span><span class="p">)</span>
        <span class="n">ch_glucose</span> <span class="o">=</span> <span class="o">-</span> <span class="n">fermented</span>
        <span class="n">ch_Ethanol</span> <span class="o">=</span> <span class="mf">0.5111</span><span class="o">*</span><span class="n">fermented</span> <span class="o">*</span> <span class="n">mw_glucose</span><span class="o">/</span><span class="n">mw_Ethanol</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ch_Ethanol</span><span class="p">,</span> <span class="n">ch_glucose</span><span class="p">]</span>
        <span class="n">out</span><span class="o">.</span><span class="n">mol</span><span class="p">[[</span><span class="n">e</span><span class="p">,</span> <span class="n">g</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">changes</span>
        <span class="n">CO2</span><span class="o">.</span><span class="n">mol</span><span class="p">[</span><span class="n">co2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5111</span><span class="p">)</span><span class="o">*</span><span class="n">fermented</span> <span class="o">*</span> <span class="n">mw_glucose</span><span class="o">/</span><span class="mf">44.0095</span>
    
    <span class="k">def</span> <span class="nf">number_of_reactors_at_minimum_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">totalcosts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_totalcosts</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span>
        <span class="n">cost_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
        <span class="n">cost_new</span> <span class="o">=</span> <span class="n">totalcosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">while</span> <span class="n">cost_new</span> <span class="o">&lt;</span> <span class="n">cost_old</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">simulate</span><span class="p">()</span>
            <span class="n">cost_old</span> <span class="o">=</span> <span class="n">cost_new</span>
            <span class="n">cost_new</span> <span class="o">=</span> <span class="n">totalcosts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">volnet</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;tau&#39;</span><span class="p">]</span>
        <span class="n">tau_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_0</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Design&#39;</span><span class="p">]</span>
        <span class="n">Design</span><span class="p">[</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kwargs</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="n">Design</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_solve</span><span class="p">(</span><span class="n">v_0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_V_wf</span><span class="p">))</span>
        <span class="n">hx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cooler</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">_mol</span><span class="p">[:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mol</span><span class="o">/</span><span class="n">N</span> 
        <span class="n">hu</span> <span class="o">=</span> <span class="n">hx</span><span class="o">.</span><span class="n">_heat_utilities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Hnet</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">_design</span><span class="p">(</span><span class="n">hu</span><span class="o">.</span><span class="n">duty</span><span class="p">)</span>
        <span class="n">hx</span><span class="o">.</span><span class="n">_cost</span><span class="p">()</span>
        <span class="n">hu</span><span class="o">.</span><span class="n">duty</span> <span class="o">*=</span> <span class="n">N</span>
        <span class="n">hu</span><span class="o">.</span><span class="n">cost</span> <span class="o">*=</span> <span class="n">N</span>
        <span class="n">hu</span><span class="o">.</span><span class="n">flow</span> <span class="o">*=</span> <span class="n">N</span>
    
    <span class="k">def</span> <span class="nf">_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">][</span><span class="s1">&#39;Coolers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Design&#39;</span><span class="p">][</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">]</span>
                                         <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cooler</span><span class="o">.</span><span class="n">_results</span><span class="p">[</span><span class="s1">&#39;Cost&#39;</span><span class="p">][</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">])</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Yoel Cortes-Pena and Jeremy Guest

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>