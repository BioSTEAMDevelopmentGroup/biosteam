

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>biosteam.units._fermentation &mdash; BioSTEAM 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> BioSTEAM
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Tutorial</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Getting started.html">3. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Creating a Unit.html">4. Creating a Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Managing flowsheets.html">5. Managing flowsheets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Using -pipe- notation.html">6. Using -pipe- notation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Unit operation results.html">7. Unit operation results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Process specifications.html">8. Process specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Importing biorefineries.html">9. Importing bioferineries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Techno-economic analysis.html">10. Techno-economic analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Building a biorefinery.html">11. Building a biorefinery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Inheriting from Unit.html">12. Inheriting from Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Unit decorators.html">13. Unit decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorial/Monte Carlo.html">14. Monte Carlo</a></li>
</ul>
<p class="caption"><span class="caption-text">BioSTEAM API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Unit.html">Unit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../PowerUtility.html">PowerUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../UtilityAgent.html">UtilityAgent</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../HeatUtility.html">HeatUtility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../System.html">System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../TEA.html">TEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../CombinedTEA.html">CombinedTEA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Flowsheet.html">Flowsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../units/units.html">units</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluation/evaluation.html">evaluation</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer's guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../developer's guide/Contributing to BioSTEAM.html">Contributing to BioSTEAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer's guide/Code of conduct.html">Code of conduct</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">BioSTEAM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>biosteam.units._fermentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for biosteam.units._fermentation</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Thu Aug 23 22:45:47 2018</span>

<span class="sd">@author: yoelr</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">._hx</span> <span class="kn">import</span> <span class="n">HXutility</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">Unit</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">from</span> <span class="nn">.decorators</span> <span class="kn">import</span> <span class="n">cost</span>
<span class="kn">from</span> <span class="nn">._tank</span> <span class="kn">import</span> <span class="n">MixTank</span>
<span class="kn">from</span> <span class="nn">.design_tools</span> <span class="kn">import</span> <span class="n">size_batch</span>
<span class="kn">from</span> <span class="nn">thermosteam.reaction</span> <span class="kn">import</span> <span class="n">Reaction</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Fermentation&#39;</span><span class="p">,)</span>

<div class="viewcode-block" id="Fermentation"><a class="viewcode-back" href="../../../units/Fermentation.html#biosteam.units.Fermentation">[docs]</a><span class="nd">@cost</span><span class="p">(</span><span class="s1">&#39;Reactor volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Cleaning in place&#39;</span><span class="p">,</span> <span class="n">CE</span><span class="o">=</span><span class="mf">521.9</span><span class="p">,</span>
      <span class="n">cost</span><span class="o">=</span><span class="mf">421e3</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="mi">3785</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">BM</span><span class="o">=</span><span class="mf">1.8</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
<span class="nd">@cost</span><span class="p">(</span><span class="s1">&#39;Reactor volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Agitators&#39;</span><span class="p">,</span> <span class="n">CE</span><span class="o">=</span><span class="mf">521.9</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">52500</span><span class="p">,</span>
      <span class="n">S</span><span class="o">=</span><span class="mi">3785</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">kW</span><span class="o">=</span><span class="mf">22.371</span><span class="p">,</span> <span class="n">BM</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
<span class="nd">@cost</span><span class="p">(</span><span class="s1">&#39;Reactor volume&#39;</span><span class="p">,</span> <span class="s1">&#39;Reactors&#39;</span><span class="p">,</span> <span class="n">CE</span><span class="o">=</span><span class="mf">521.9</span><span class="p">,</span> <span class="n">cost</span><span class="o">=</span><span class="mi">844000</span><span class="p">,</span>
      <span class="n">S</span><span class="o">=</span><span class="mi">3785</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">BM</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="s1">&#39;N&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Fermentation</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a Fermentation object which models large-scale batch fermentation</span>
<span class="sd">    for the production of 1st generation ethanol using yeast</span>
<span class="sd">    [1]_ [2]_ [3]_ [4]_. A compound with CAS &#39;Yeast&#39; must be present.</span>
<span class="sd">    Only sucrose and glucose are taken into account for conversion.</span>
<span class="sd">    Conversion is based on reaction time, `tau`. Cleaning and unloading time,</span>
<span class="sd">    `tau_0`, fraction of working volume, `V_wf`, and number of reactors,</span>
<span class="sd">    `N_reactors`, are attributes that can be changed. Cost of a reactor</span>
<span class="sd">    is based on the NREL batch fermentation tank cost assuming volumetric</span>
<span class="sd">    scaling with a 6/10th exponent [5]_. </span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ins : streams</span>
<span class="sd">        Inlet fluids to be mixed into the fermentor.</span>
<span class="sd">    outs : stream sequence</span>
<span class="sd">        * [0] Vent</span>
<span class="sd">        * [1] Effluent</span>
<span class="sd">    tau : float</span>
<span class="sd">        Reaction time.</span>
<span class="sd">    efficiency=0.9 : float, optional</span>
<span class="sd">        User enforced efficiency.</span>
<span class="sd">    iskinetic=False: bool, optional</span>
<span class="sd">        If True, `Fermenation.kinetic_model` will be used.</span>
<span class="sd">    N : int</span>
<span class="sd">        Number of batch reactors</span>
<span class="sd">    T=305.15 : float</span>
<span class="sd">        Temperature of reactor [K].</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Simulate a Fermentation object which models batch fermentation for the</span>
<span class="sd">    production of 1st generation ethanol using yeast.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from biorefineries.lipidcane.chemicals import ethanol_chemicals </span>
<span class="sd">    &gt;&gt;&gt; from biosteam.units import Fermentation</span>
<span class="sd">    &gt;&gt;&gt; from biosteam import Stream, settings</span>
<span class="sd">    &gt;&gt;&gt; settings.set_thermo(ethanol_chemicals)</span>
<span class="sd">    &gt;&gt;&gt; feed = Stream(&#39;feed&#39;,</span>
<span class="sd">    ...               Water=1.20e+05,</span>
<span class="sd">    ...               Glucose=1.89e+03,</span>
<span class="sd">    ...               Sucrose=2.14e+04,</span>
<span class="sd">    ...               DryYeast=1.03e+04,</span>
<span class="sd">    ...               units=&#39;kg/hr&#39;,</span>
<span class="sd">    ...               T=32+273.15)</span>
<span class="sd">    &gt;&gt;&gt; F1 = Fermentation(&#39;F1&#39;,</span>
<span class="sd">    ...                   ins=feed, outs=(&#39;CO2&#39;, &#39;product&#39;),</span>
<span class="sd">    ...                   tau=8, efficiency=0.90, N=8)</span>
<span class="sd">    &gt;&gt;&gt; F1.simulate()</span>
<span class="sd">    &gt;&gt;&gt; F1.show()</span>
<span class="sd">    Fermentation: F1</span>
<span class="sd">    ins...</span>
<span class="sd">    [0] feed</span>
<span class="sd">        phase: &#39;l&#39;, T: 305.15 K, P: 101325 Pa</span>
<span class="sd">        flow (kmol/hr): Water     6.66e+03</span>
<span class="sd">                        Glucose   10.5</span>
<span class="sd">                        Sucrose   62.5</span>
<span class="sd">                        DryYeast  1.03e+04</span>
<span class="sd">    [1] missing stream</span>
<span class="sd">    outs...</span>
<span class="sd">    [0] CO2</span>
<span class="sd">        phase: &#39;g&#39;, T: 305.15 K, P: 101325 Pa</span>
<span class="sd">        flow (kmol/hr): Water    2.5</span>
<span class="sd">                        CO2      244</span>
<span class="sd">                        Ethanol  0.582</span>
<span class="sd">    [1] product</span>
<span class="sd">        phase: &#39;l&#39;, T: 305.15 K, P: 101325 Pa</span>
<span class="sd">        flow (kmol/hr): Water     6.6e+03</span>
<span class="sd">                        Ethanol   243</span>
<span class="sd">                        Glucose   13.6</span>
<span class="sd">                        DryYeast  1.03e+04</span>
<span class="sd">    &gt;&gt;&gt; F1.results()</span>
<span class="sd">    Fermentation                                       Units        F1</span>
<span class="sd">    Power               Rate                              kW      11.5</span>
<span class="sd">                        Cost                          USD/hr     0.899</span>
<span class="sd">    Chilled water       Duty                           kJ/hr -2.91e+06</span>
<span class="sd">                        Flow                         kmol/hr  1.95e+03</span>
<span class="sd">                        Cost                          USD/hr      14.5</span>
<span class="sd">    Design              Reactor volume                    m3       243</span>
<span class="sd">                        Cycle time                        hr      12.6</span>
<span class="sd">                        Loading time                      hr      1.57</span>
<span class="sd">                        Cleaning and unloading time       hr         3</span>
<span class="sd">                        Working volume fraction                    0.9</span>
<span class="sd">                        Number of reactors                           8</span>
<span class="sd">    Purchase cost       Coolers                          USD   3.7e+04</span>
<span class="sd">                        Reactors                         USD  1.86e+06</span>
<span class="sd">                        Agitators                        USD  1.16e+05</span>
<span class="sd">                        Cleaning in place                USD  7.05e+05</span>
<span class="sd">    Total purchase cost                                  USD  2.72e+06</span>
<span class="sd">    Utility cost                                      USD/hr      15.4</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Oliveira, Samuel C., et al. &quot;Discrimination between ethanol inhibition models in a continuous alcoholic fermentation process using flocculating yeast.&quot; Applied biochemistry and biotechnology 74.3 (1998): 161-172.</span>
<span class="sd">    </span>
<span class="sd">    .. [2] Oliveira, Samuel C., et al. &quot;Continuous ethanol fermentation in a tower reactor with flocculating yeast recycle: scale-up effects on process performance, kinetic parameters and model predictions.&quot; Bioprocess Engineering 20.6 (1999): 525-530.</span>
<span class="sd">    </span>
<span class="sd">    .. [3] Oliveira, Samuel C., et al. &quot;Mathematical modeling of a continuous alcoholic fermentation process in a two-stage tower reactor cascade with flocculating yeast recycle.&quot; Bioprocess and biosystems engineering 38.3 (2015): 469-479.</span>
<span class="sd">    </span>
<span class="sd">    .. [4] Oliveira, Samuel C., et al. &quot;Kinetic Modeling of 1‚ÄêG Ethanol Fermentations.&quot; Fermentation Processes. InTech, 2017.</span>
<span class="sd">    </span>
<span class="sd">    .. [5] D. Humbird, R. Davis, L. Tao, C. Kinchin, D. Hsu, and A. Aden National. Renewable Energy Laboratory Golden, Colorado. P. Schoen, J. Lukas, B. Olthof, M. Worley, D. Sexton, and D. Dudgeon. Harris Group Inc. Seattle, Washington and Atlanta, Georgia. Process Design and Economics for Biochemical Conversion of Lignocellulosic Biomass to Ethanol Dilute-Acid Pretreatment and Enzymatic Hydrolysis of Corn Stover. May 2011. Technical Report NREL/TP-5100-47764</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_units</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Reactor volume&#39;</span><span class="p">:</span> <span class="s1">&#39;m3&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Cycle time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Loading time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">,</span>
              <span class="s1">&#39;Total dead time&#39;</span><span class="p">:</span> <span class="s1">&#39;hr&#39;</span><span class="p">}</span>
    <span class="n">_N_ins</span> <span class="o">=</span> <span class="n">_N_outs</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">_N_heat_utilities</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_has_power_utility</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39;Fermentation&#39;</span>    
    
    <span class="c1">#: [bool] If True, number of reactors (N) is chosen as to minimize installation cost in every simulation. Otherwise, N remains constant.</span>
    <span class="n">autoselect_N</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1">#: [float] Cleaning and unloading time (hr)</span>
    <span class="n">tau_0</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="c1">#: [float] Fraction of filled tank to total tank volume</span>
    <span class="n">V_wf</span> <span class="o">=</span> <span class="mf">0.9</span>
    
    <span class="c1">#: tuple[float] Kinetic parameters for the kinetic model. Default constants are fitted for Oliveria&#39;s model (mu_m1, mu_m2, Ks1, Ks2, Pm1, Pm2, Xm, Y_PS, a)</span>
    <span class="n">kinetic_constants</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.31</span><span class="p">,</span>  <span class="c1"># mu_m1</span>
                         <span class="mf">1.01</span><span class="p">,</span>  <span class="c1"># mu_m2</span>
                         <span class="mf">1.88</span><span class="p">,</span>  <span class="c1"># Ks1</span>
                         <span class="mf">2.81</span><span class="p">,</span>  <span class="c1"># Ks2</span>
                         <span class="mf">82.8</span><span class="p">,</span>  <span class="c1"># Pm1</span>
                         <span class="mf">108.2</span><span class="p">,</span> <span class="c1"># Pm2</span>
                         <span class="mf">113.4</span><span class="p">,</span> <span class="c1"># Xm</span>
                         <span class="mf">0.45</span><span class="p">,</span>  <span class="c1"># Y_PS</span>
                         <span class="mf">0.18</span><span class="p">)</span>  <span class="c1"># a</span>
    
    <span class="k">def</span> <span class="nf">_get_design_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="s1">&#39;Cleaning and unloading time&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_0</span><span class="p">,</span> <span class="s1">&#39;hr&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;Working volume fraction&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_wf</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;Number of reactors&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outs</span><span class="o">=</span><span class="p">(),</span> <span class="n">thermo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> 
                 <span class="n">tau</span><span class="p">,</span>  <span class="n">N</span><span class="p">,</span> <span class="n">efficiency</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">iskinetic</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mf">305.15</span><span class="p">):</span>
        <span class="n">Unit</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="n">ins</span><span class="p">,</span> <span class="n">outs</span><span class="p">,</span> <span class="n">thermo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hydrolysis</span> <span class="o">=</span> <span class="n">Reaction</span><span class="p">(</span><span class="s1">&#39;Sucrose + Water -&gt; 2Glucose&#39;</span><span class="p">,</span> <span class="s1">&#39;Sucrose&#39;</span><span class="p">,</span> <span class="mf">1.00</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fermentation</span> <span class="o">=</span> <span class="n">Reaction</span><span class="p">(</span><span class="s1">&#39;Glucose -&gt; 2Ethanol + 2CO2&#39;</span><span class="p">,</span>  <span class="s1">&#39;Glucose&#39;</span><span class="p">,</span> <span class="n">efficiency</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iskinetic</span> <span class="o">=</span> <span class="n">iskinetic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">efficiency</span> <span class="o">=</span> <span class="n">efficiency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">tau</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooler</span> <span class="o">=</span> <span class="n">HXutility</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vent</span><span class="p">,</span> <span class="n">effluent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">vent</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="s1">&#39;g&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cooler</span><span class="o">.</span><span class="n">_outs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">effluent</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">vent</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>

    <span class="k">def</span> <span class="nf">_calc_efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">feed</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="c1"># Get initial concentrations</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">indices</span><span class="p">([</span><span class="s1">&#39;Yeast&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;64-17-5&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;492-61-5&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;7732-18-5&#39;</span><span class="p">])</span>
        <span class="n">mass</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">mass</span>
        <span class="n">F_vol</span> <span class="o">=</span> <span class="n">feed</span><span class="o">.</span><span class="n">F_vol</span>
        <span class="n">concentration_in</span> <span class="o">=</span> <span class="n">mass</span><span class="o">/</span><span class="n">F_vol</span>
        <span class="n">X0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">S0</span> <span class="o">=</span> <span class="p">(</span><span class="n">concentration_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>
        
        <span class="c1"># Integrate to get final concentration</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">C_t</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">kinetic_model</span><span class="p">,</span> <span class="p">(</span><span class="n">X0</span><span class="p">,</span> <span class="n">P0</span><span class="p">,</span> <span class="n">S0</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span>
                     <span class="n">args</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kinetic_constants</span><span class="p">)</span>
        <span class="c1"># Cache data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_X</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_P</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_S</span> <span class="o">=</span> <span class="n">S</span> <span class="o">=</span> <span class="n">C_t</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
        
        <span class="c1"># Calculate efficiency</span>
        <span class="n">Sf</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Sf</span> <span class="o">=</span> <span class="n">Sf</span> <span class="k">if</span> <span class="n">Sf</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">Y_PS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinetic_constants</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">eff</span> <span class="o">=</span> <span class="p">(</span><span class="n">S0</span> <span class="o">-</span> <span class="n">Sf</span><span class="p">)</span><span class="o">/</span><span class="n">S0</span> <span class="o">*</span> <span class="n">Y_PS</span><span class="o">/</span><span class="mf">0.511</span>
        <span class="k">return</span> <span class="n">eff</span>
        
<div class="viewcode-block" id="Fermentation.kinetic_model"><a class="viewcode-back" href="../../../units/Fermentation.html#biosteam.units.Fermentation.kinetic_model">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">kinetic_model</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">kinetic_constants</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return change of yeast, ethanol, and substrate concentration in kg/m3.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        z : Iterable with (X, E, S) [-]:</span>
<span class="sd">            * X: Yeast concentration (kg/m3)</span>
<span class="sd">            * P: Ethanol concentration (kg/m3)</span>
<span class="sd">            * S: Substrate concentration (kg/m3)</span>
<span class="sd">        </span>
<span class="sd">        t : float</span>
<span class="sd">            Time point</span>
<span class="sd">        </span>
<span class="sd">        *kinetic_constants</span>
<span class="sd">            * mu_m1: Maximum specific growth rate (1/hr)</span>
<span class="sd">            * mu_m2: Maximum specific ethanol production rate (g-product/g-cell-hr)</span>
<span class="sd">            * Ks1: Sugar saturation constant for growth (g/L)</span>
<span class="sd">            * Ks2: Sugar saturation constant for product (g/L)</span>
<span class="sd">            * Pm1: Maximum product concentration at zero growth [mu_m1=0] (g/L)</span>
<span class="sd">            * Pm2: Maximum product concentration [mu_m2=0] (g/L)</span>
<span class="sd">            * Xm: Maximum cell concentration [mu_m1=0] (g/L)</span>
<span class="sd">            * Y_PS: Ethanol yield based on sugar consumed</span>
<span class="sd">            * a: Toxic power</span>
<span class="sd">                </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mu_m1</span><span class="p">,</span> <span class="n">mu_m2</span><span class="p">,</span> <span class="n">Ks1</span><span class="p">,</span> <span class="n">Ks2</span><span class="p">,</span> <span class="n">Pm1</span><span class="p">,</span> <span class="n">Pm2</span><span class="p">,</span> <span class="n">Xm</span><span class="p">,</span> <span class="n">Y_PS</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">kinetic_constants</span>
        
        <span class="c1"># Current yeast, ethanol, and glucose concentration (kg/m3)</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">S</span> <span class="o">=</span> <span class="n">z</span>
        
        <span class="c1"># Compute coefficients</span>
        <span class="n">mu_X</span> <span class="o">=</span> <span class="n">mu_m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">Ks1</span> <span class="o">+</span> <span class="n">S</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="o">/</span><span class="n">Pm1</span><span class="p">)</span><span class="o">**</span><span class="n">a</span><span class="o">*</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">X</span><span class="o">/</span><span class="n">Xm</span><span class="p">))</span>
        <span class="n">mu_P</span> <span class="o">=</span> <span class="n">mu_m2</span> <span class="o">*</span> <span class="p">(</span><span class="n">S</span><span class="o">/</span><span class="p">(</span><span class="n">Ks2</span> <span class="o">+</span> <span class="n">S</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">P</span><span class="o">/</span><span class="n">Pm2</span><span class="p">)</span>
        <span class="n">mu_S</span> <span class="o">=</span> <span class="n">mu_P</span><span class="o">/</span><span class="mf">0.45</span>
        
        <span class="c1"># Compute derivatives</span>
        <span class="n">dXdt</span> <span class="o">=</span> <span class="n">mu_X</span> <span class="o">*</span> <span class="n">X</span>
        <span class="n">dPdt</span> <span class="o">=</span> <span class="p">(</span><span class="n">mu_P</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span>
        <span class="n">dSdt</span> <span class="o">=</span>  <span class="o">-</span> <span class="n">mu_S</span> <span class="o">*</span> <span class="n">X</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">dXdt</span><span class="p">,</span> <span class="n">dPdt</span><span class="p">,</span> <span class="n">dSdt</span><span class="p">)</span></div>
       
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;[int] Number of reactors&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>
    <span class="nd">@N</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">N</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">N</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;number of reactors must be greater than 1, value </span><span class="si">{N}</span><span class="s2"> is infeasible&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">=</span> <span class="n">N</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fermentation</span><span class="o">.</span><span class="n">X</span>
    <span class="nd">@efficiency</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">efficiency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">efficiency</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fermentation</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="n">efficiency</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau</span>
    <span class="nd">@tau</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tau</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tau</span> <span class="o">=</span> <span class="n">tau</span>

    <span class="k">def</span> <span class="nf">_run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">vent</span><span class="p">,</span> <span class="n">effluent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span>
        <span class="n">effluent</span><span class="o">.</span><span class="n">mix_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ins</span><span class="p">)</span>
        <span class="n">effluent_mol</span> <span class="o">=</span> <span class="n">effluent</span><span class="o">.</span><span class="n">mol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hydrolysis</span><span class="p">(</span><span class="n">effluent_mol</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">iskinetic</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fermentation</span><span class="o">.</span><span class="n">X</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calc_efficiency</span><span class="p">(</span><span class="n">effluent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fermentation</span><span class="p">(</span><span class="n">effluent_mol</span><span class="p">)</span>
        <span class="n">vent</span><span class="o">.</span><span class="n">receive_vent</span><span class="p">(</span><span class="n">effluent</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">N_at_minimum_capital_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cost_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>
        <span class="n">cost_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">purchase_cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">cost_new</span> <span class="o">&lt;</span> <span class="n">cost_old</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_summary</span><span class="p">()</span>
            <span class="n">cost_old</span> <span class="o">=</span> <span class="n">cost_new</span>
            <span class="n">cost_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">purchase_cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_N</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>
        <span class="k">return</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">_design</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">effluent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v_0</span> <span class="o">=</span> <span class="n">effluent</span><span class="o">.</span><span class="n">F_vol</span>
        <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tau</span>
        <span class="n">tau_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_0</span>
        <span class="n">Design</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">design_results</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autoselect_N</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoselect_N</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_at_minimum_capital_cost</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">autoselect_N</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">N</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_N</span>
        <span class="n">Design</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">size_batch</span><span class="p">(</span><span class="n">v_0</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">tau_0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_wf</span><span class="p">))</span>
        <span class="n">hx_effluent</span> <span class="o">=</span> <span class="n">effluent</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">hx_effluent</span><span class="o">.</span><span class="n">mol</span><span class="p">[:]</span> <span class="o">/=</span> <span class="n">N</span>
        <span class="n">cooler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooler</span>
        <span class="n">cooler</span><span class="o">.</span><span class="n">simulate_as_auxiliary_exchanger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hnet</span><span class="o">/</span><span class="n">N</span><span class="p">,</span> <span class="n">hx_effluent</span><span class="p">)</span>
        <span class="n">hu_fermentation</span><span class="p">,</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">heat_utilities</span>
        <span class="n">hu_cooler</span><span class="p">,</span> <span class="o">=</span> <span class="n">cooler</span><span class="o">.</span><span class="n">heat_utilities</span>
        <span class="n">hu_fermentation</span><span class="o">.</span><span class="n">copy_like</span><span class="p">(</span><span class="n">hu_cooler</span><span class="p">)</span>
        <span class="n">hu_fermentation</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purchase_costs</span><span class="p">[</span><span class="s1">&#39;Coolers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cooler</span><span class="o">.</span><span class="n">purchase_costs</span><span class="p">[</span><span class="s1">&#39;Heat exchanger&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">N</span></div>
        
    
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Yoel Cortes-Pena and Jeremy Guest

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>